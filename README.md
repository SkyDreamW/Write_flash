# STM32 Write Flash 项目

## 项目简介
该项目包含一个 STM32 系统的 Flash 写入模块和一个 PC 端的上位机程序。用户可以使用上位机程序通过串口将数据写入 STM32 上的 Flash 存储器。

- **源代码** 位于 `User` 文件夹。
- **PC 端上位机程序** 位于 `Windows` 文件夹，包含用于生成数据并发送至 STM32 的程序。

## 使用方法

### 1. 生成 .bin 文件
在 `Windows` 文件夹中的 `makebin.cpp` 脚本用于将数组生成 `.bin` 文件。你可以通过 vscode 的 `run_code` 插件来执行该程序并生成 `.bin` 文件。

### 2. 使用上位机发送程序
`WriteToFlash.bat` 是上位机程序的启动脚本。执行此脚本将启动 `WriteToFlash.exe`，并允许你通过串口将 `.bin` 文件中的数据发送到 STM32。

```bash
WriteToFlash.bat
```

### 数据发送过程

在该项目中，主机（PC端）通过串口向从机（STM32）发送数据，数据传输过程包括以下几个步骤：

1. **主机发送数据**  
   主机将需要写入从机 Flash 存储器的数据通过串口发送到 STM32。数据包包含三部分：
   - **数据本身**：实际需要传输和写入的内容。
   - **结束判断位**：一个标志位，用于标识数据传输的结束。它的作用是告诉从机数据是否已经完整传输完成，防止数据丢失或不完整。
   - **CRC16 校验值**：用于验证数据完整性的校验值，确保在传输过程中数据没有被篡改或损坏。

   数据包的结构如下：
```bash
[数据本身] + [结束判断位] + [CRC16 校验值]
```

2. **从机接收数据**  
STM32 从机通过串口接收主机发送的数据包后，首先会提取其中的三部分内容：
- 数据本身（待写入 Flash 的数据）
- 结束判断位（用于确认数据是否完整）
- CRC16 校验值（用于数据验证）

3. **数据校验**  
在接收到数据包后，从机会使用 CRC16 校验算法计算接收到的数据本身的 CRC 校验值。然后，从机会将计算出的 CRC16 校验值与主机发送过来的 CRC16 校验值进行比较：
- 如果计算出的 CRC16 校验值与接收到的校验值一致，表示数据传输正确，校验通过。
- 如果校验值不一致，表示数据可能在传输过程中出现了错误，从机会拒绝进行后续操作并返回错误信息给主机，主机重新发送数据，错误超过五次结束此次写入
